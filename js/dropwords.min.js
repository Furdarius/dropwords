(function(d){d.fn.dropwords=function(j){this.each(function(){var g=function(a){if(!e.is(":visible"))return!1;var c=d(b.rowSelector,e),f=c.filter("."+b.curRowClass),f=0<f.length?f.removeClass(b.curRowClass)[a]().addClass(b.curRowClass):c.eq("prev"==a?f.length-1:0).addClass(b.curRowClass);b.autoFill&&h.val(f.html())},c={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},h=d(this),b=d.extend({resBlockSelector:"#variants",rowSelector:"ul > li",curRowClass:"targeted",url:"search.php",
valuePostName:"value",postAction:"search",params:{},minChars:2,rowsSelection:!0,autoFill:!0},j),e=d(b.resBlockSelector).hide();h.on("keyup",function(a){for(k in c)if(c[k]==a.which)return!1;var g=h.val();g.length>=b.minChars&&d.ajax({type:"POST",url:b.url,dataType:"json",data:"action="+b.postAction+"&"+b.valuePostName+"="+g+"&params="+JSON.stringify(b.params),success:function(a){e.html(a.result).show()}});a.preventDefault()}).on("keydown",function(a){switch(a.which){case c.PAGEUP:case c.UP:a.preventDefault();
if(!b.rowsSelection)return!1;g("prev");break;case c.PAGEDOWN:case c.DOWN:a.preventDefault();if(!b.rowsSelection)return!1;g("next");break;case c.ESC:case c.RETURN:case c.DEL:case c.BACKSPACE:e.hide()}}).on("blur",function(){setTimeout(function(){e.hide()},100)});e.click(function(a){if(0==!a.button)return!1;for(a=a.target;a&&"LI"!=a.tagName;)a=a.parentNode;h.val(d(!a?[]:a).html()).focus();e.hide()})});return this}})(jQuery);